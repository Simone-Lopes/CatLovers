<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>CatLovers | Cadastrar Gato</title>

  <script src="../js/funcoes.js"></script>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/cadastroGato.css">

  <link rel="icon" href="../assets/icon/favicon.png">

</head>

<body>

  <!-- Navbar superior -->
  <div class="header">
    <div class="container">

      <div class="logo">
        <img class="logo" src="../assets/imgs/Logotipo-horizontal.png" alt="logo catlovers">
      </div>

      <div class="org-nav-bar">
        <ul class="navbar">
          <li class="pagina"><a href="catblog.html">CatBlog</a></li>
          <li class="paginas"><a href="adocao.html">Adoção</a></li>
          <li class="paginas"><a href="simulador.html">Simulador</a></li>
        </ul>
        <ul class="navbar2">
          <li class="agora"><a href="cadastroGato.html">Cadastrar Gato</a></li>
          <li>|</li>
          <li class="paginas"><a href="../index.html">Sair</a></li>
        </ul>
      </div>

    </div>
  </div>

  <!-- iniciando tela -->
  <div class="cadastroGato">
    <div class="container-cadastro">

      <!-- 
                <div class="card-imagem">
                </div> -->

      <!-- formulário -->
      <div class="card-cadastroGato">

        <div class="formulario">
          <h2>CatLovers!</h2>
          <p>Para cadastrar o gatinho, coloque as seguintes informações...</p>
          <div class="campo">
            <span>Nome do gato:</span><br>
            <input id="input_nomeGato" type="text" placeholder="Digite o nome do gato">
          </div>

          <div class="campo">
            <span>Sexo:</span><br>
            <select id="input_sexo">
              <option value="" disabled selected>Selecione...</option>
              <option value="Macho">Macho</option>
              <option value="Fêmea">Fêmea</option>
            </select>
          </div>

          <div class="campo">
            <span>Idade:</span><br>
            <select id="input_idade">
              <option value="" disabled selected>Selecione...</option>
              <option value="Filhote">Filhote</option>
              <option value="Jovem">Jovem</option>
              <option value="Adulto">Adulto</option>
              <option value="Idoso">Idoso</option>
              <option value="Não identificado">Não identificado</option>
            </select>
          </div>

          <div class="campo">
            <span>Porte:</span><br>
            <select id="input_porte">
              <option value="" disabled selected>Selecione...</option>
              <option value="Pequeno">Pequeno</option>
              <option value="Médio">Médio</option>
              <option value="Grande">Grande</option>
            </select>
          </div>

          <div class="campo">
            <span>Pelagem:</span><br>
            <textarea id="input_pelagem" placeholder="Descreva o pelo do gato" required></textarea>
          </div>

        </div>
      </div>

      <!-- Segunda parte do formulário -->
      <!-- formulário -->
      <div class="card-cadastroGato">
        <div class="formulario">
          <h2>Saúde</h2>
          <p>Informe as condições de saúde do gato...</p>

          <div class="campo">
            <span>Vacina:</span><br>
            <select id="input_vacina">
              <option value="" disabled selected>Selecione...</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
              <option value="Não sei">Não sei</option>
            </select>
          </div>

          <div class="campo">
            <span>Castrado:</span><br>
            <select id="input_castrado">
              <option value="" disabled selected>Selecione...</option>
              <option value="Sim">Sim</option>
              <option value="Não">Não</option>
              <option value="Não sei">Não sei</option>
            </select>
          </div>

          <div class="campo">
            <span>Tamanho:</span><br>
            <input type="number" id="input_tamanho" placeholder="Digite o tamanho do gato. ex: 0.20" required>
          </div>

          <div class="campo">
            <span>Peso:</span><br>
            <input type="number" id="input_peso" placeholder="Digite o peso do gato. ex: 2.200" required>
          </div>

        </div>
      </div>

      <!-- Terceiraparte do formulário -->
      <!-- formulário -->
      <div class="card-cadastroGato">
        <div class="formulario">
          <h2>Características</h2>
          <p>Informe as características do seu gato para impressionar os futuros papais...</p>

          <div class="campo">
            <span>História:</span><br>
            <textarea id="input_historia" placeholder="Conte a história do gatinho. DICA: Escreva de forma emocionante!"
              required></textarea>
          </div>

          <div class="campo">
            <span>Link de fotos:</span><br>
            <input type="link" id="input_link" placeholder="Insira um link com fotos do pet (OPCIONAL)" required>
          </div>

          <div class="campo">
            <span>Selecione a que mais se parece com o pet:</span><br>
            <select id="input_imagem">
              <option value="" disabled selected>Selecione...</option>
              <option value="laranja">Laranja</option>
            </select>
            <br><img src="../assets/imgs/foto-Mel.jpg" alt="" style="height: 100px;">
          </div>
        </div>
      </div>

      <!-- Quarta parte do formulário -->
      <!-- formulário -->
      <div class="card-cadastroGato">
        <div class="formulario">
          <h2>Finalizando</h2>
          <p>Fique tranquilo! A confirmação de email é para garantir a segurança do gatinho e do registro</p>

          <div class="campo">
            <span>Confirme seu email:</span><br>
            <input id="input_confirmarEmail" type="email" placeholder="Insira seu email" required>
          </div>

          <button class="button-cadastrar" onclick="cadastrar()">Cadastrar Gato</button>
          <a href="./cadastro.html">Quer adotar um gatinho?</a>

          <!-- mensagem de erro -->
          <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
              <span id="mensagem_erro"></span>
            </div>
          </div>

          <div id="div_aguardar" class="loading-div">
            <!-- <img src="../assets/circle-loading.gif" id="loading-gif"> -->
          </div>

        </div>
      </div>
    </div>
  </div>




      <!-- Footer -->
      <div class="footer">
        <div class="container">

          <div class="footer-left">
            <img src="../assets/imgs/Logotipo-Vertical (2).png" alt="logo" width="200px">
          </div>

          <div class="footer-info">
            <h1>Compania</h1>
            <a class="footer-nav" href="index.html">Home</a>
            <a class="footer-nav" href="sobreNos.html">Sobre Nós</a>
            <a class="footer-nav" href="faleConosco.html">Fale Conosco</a>
          </div>

          <div class="footer-info">
            <h1>Usuário</h1>
            <a class="footer-nav" href="login.html">Login</a>
            <a class="footer-nav" href="cadastro.html">Cadastro</a>
            <a class="footer-nav" href="cadastroGato.html">Cadastrar gato</a>
          </div>

          <div class="footer-info">
            <h1>Gatinhos</h1>
            <a class="footer-nav" href="simulador.html">Adoção</a>
            <a class="footer-nav" href="simulador.html">CatBlog</a>
            <a class="footer-nav" href="simulador.html">Simulação</a>
          </div>

        </div>
      </div>
</body>

</html>

<script>
  function cadastrar() {

    aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeGatoVar = input_nomeGato.value;
    var sexoVar = input_sexo.value;
    var idadeVar = input_idade.value;
    var porteVar = input_porte.value;
    var vacinaVar = input_vacina.value;
    var castradoVar = input_castrado.value;
    var pelagemVar = input_pelagem.value;
    var tamanhoVar = Number(input_tamanho.value);
    var pesoVar = Number(input_peso.value);
    var historiaVar = input_historia.value;
    var linkVar = input_link.value;
    var imagemVar = input_imagem.value;
    var confirmarEmailVar = input_confirmarEmail.value;


    if (nomeGatoVar == "" || sexoVar == "" || idadeVar == "" || porteVar == "" || vacinaVar == "" ||
      castradoVar == "" || pelagemVar == "" || tamanhoVar == "" || pesoVar == "" || historiaVar == "" ||
      linkVar == "" || imagemVar == "" || confirmarEmailVar == "") {
      cardErro.style.display = "block"
      //  mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";

      finalizarAguardar();
      //  return false;
    }
    else {
      setInterval(sumirMensagem, 5000)
    }

    // Enviando o valor da nova input
    fetch("../gatos/cadastrarGato", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeGatoServer: nomeGatoVar,
        sexoServer: sexoVar,
        idadeServer: idadeVar,
        porteServer: porteVar,
        vacinaServer: vacinaVar,
        castradoServer: castradoVar,
        pelagemServer: pelagemVar,
        tamanhoServer: tamanhoVar,
        pesoServer: pesoVar,
        historiaServer: historiaVar,
        linkServer: linkVar,
        imagemServer: imagemVar,
        confirmarEmailServer: confirmarEmailVar
      })
    }).then(function (resposta) {

      console.log("resposta: ", resposta);

      if (resposta.ok) {
        cardErro.style.color = "green";

        mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de adoção...";

        setTimeout(() => {
          window.location = "adocao.html";
        }, "2000")

        limparFormulario();
        finalizarAguardar();
      } else {
        throw ("Houve um erro ao tentar realizar o cadastro!");
      }
    }).catch(function (resposta) {
      console.log(`#ERRO: ${resposta}`);
      finalizarAguardar();
    });

    return false;
  }

  function sumirMensagem() {
    cardErro.style.display = "none"
  }

</script>